プロジェクト

名称：Calculation Invaders（計算インベーダー）

目的：小学生向けの学習×アーケードSTG。敵の上の「式」を解き、正答で撃破。四則×13段階×4スーツ＝52段の学習階段。

コアループ

敵の上に数式表示

クリック（選択）→ 画面下で答え入力

正答：敵撃破・スコア・コンボ、誤答：ライフ減・小さな前進

全滅でステージクリア → 「カードタワー」を1枚めくる

スーツと難易度（13段階）

♡ addition（足し算）：1桁→2桁→3桁→4桁、繰上有無を段階化（♡1〜13）

♠ subtraction（引き算）：1桁→2桁→3桁→4桁、借位有無（♠1〜13、結果は常に0以上）

♣ multiplication（かけ算）：九九→2桁×1桁→2桁×2桁→3桁×…→連続乗算（♣1〜13）

♦ division（わり算・分数なし）：九九逆算→2桁/3桁÷1桁→2桁÷2桁→3桁÷2桁→4桁÷2桁、あまり対応（♦1〜13）

♦11/12 は「分数系」を廃止し、整数÷整数の発展として再設計済（前会話の表に準拠）

難易度テーブルはあなたと合意済みの最新表を採用（52段）。
♦は分数を使わず、商と余りで統一。

学習要件

学年目安：

低学年＝＋/−中心（♡/♠ 1〜6）

中学年＝×/÷基礎（♣/♦ 1〜6）

高学年＝応用（各 7〜13）

復習モード：誤答ログ（式）を再出題

出題生成：ランクごとの制約に厳密準拠（繰上・借位・余り）

UI（要約）

上：
- スコア / ライフ / ステージ表示（♡/♠/♣/♦＋ランク）
- パターン（ツールチップ）、モード（5/10/20/30/∞）、残り問数（非エンドレス）

中：
- 敵は列ランダムに逐次スポーンし、インベーダー風に降下
- クリックで選択、下部からの発射弾が選択中の敵へ飛翔、命中で爆発SE/エフェクト

下：
- 選択表示＋入力欄＋発射（Enter/ボタン）

進級演出：ステージクリアでカード1枚めくり、13枚でその国解放。コレクション画面で進捗/詳細（初取得/最終/回数/ベスト）を表示

非機能

1問生成 < 1ms/件（ローカル）

60fps目標（Canvas/Phaser/DOMどれでも可）

aria-labelで数式読み上げ、色弱配慮、SE/BGMのON/OFF
初回解錠による音再生許可、設定で音量/時間制限/アクセシビリティ（大ボタン/ハイコントラスト）

成果物

/docs/spec.md（本書）

/docs/tasks.md（Kiro生成）

/docs/test-plan.md（Kiro生成）

実装：JavaScript（ESM）、ViteまたはWebpack

## 導線/フロー（詳細）

1. タイトル（`src/ui/title.js`）
   - スーツ（♡＋/♠−/♣×/♦÷）、ランク1〜13（パターンはツールチップ）、問題数（5/10/20/30/∞）、難易度（速度）を選択
   - スタート or ステージ選択（52枚）

2. ステージ選択（`src/ui/cardTower.js`）
   - 4×13のカードをオーバーレイ表示、獲得/未獲得/ロック表示、クリックで開始

3. ステージ（`src/main.js` + `src/core/spawnController.js`）
   - 入力→弾→命中判定。クリアで結果表示、カード獲得、再挑戦/次ランク/コレクション/タイトル

4. コレクション（`src/ui/collection.js`）
   - 52枚進捗、カード詳細（初取得/最終/回数/ベスト）、そのまま起動可

5. 設定（`src/ui/settings.js`）
   - SFX/BGM/音量、時間制限ON/OFF/秒、アクセシビリティ（大ボタン/ハイコントラスト）

## 保存/バージョン

- 保存キー：`ci:v1`、`schemaVersion`で互換管理（現在v2）
- v2移行時に`cardMeta`/`gameSettings`/`a11ySettings`/`questionCountMode`を補完