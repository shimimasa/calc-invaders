<!-- 5716efb0-aca7-4939-88fc-034214646cb5 eb27839b-b0e2-4ddb-aac9-cf6edcf62f7e -->
# 不具合修正/UX改善 まとめ実装計画

## 対応内容

- ゲームオーバー後のボタン無反応を解消
- `gameOver()`で必ず`ctrl.stop()`とイベント解除、オーバーレイ上のボタンから`start()`/選択へ確実に遷移
- オーバーレイの`z-index`/pointer-eventsを再確認（既存OKだが念のため定義維持）

- タイトル時にHUD/グリッド/入力パネルを非表示→ステージ開始時に表示
- `start()`の`!stageId`分岐で `#top/#grid/#panel` を `style.display='none'`
- ステージ開始時に `style.display=''` で復帰
- タイトル/タワーなどのオーバーレイは `innerHTML=''` or `remove()` で確実にクリーンアップ

- ステージ選択の二重表示/前画面残りを解消
- タイトル起動時に `#tower` コンテナを初期化（残存オーバーレイの削除）
- カード選択後はオーバーレイ`wrap.remove()`（既存）＋ `#title`もクリア

- ゲームオーバー条件の再確認と限定
- ライフ<=0 または 敵が下端到達（`onBottomReached`）でのみ `gameOver()` 実行
- それ以外の自動終了（タイムアップ等）は発火させない

- 設定画面への導線をタイトルに追加
- `src/ui/title.js` に「設定」ボタンを追加し、`mountSettings`をオーバーレイとして表示（閉じる可）

- 敵（問題）クリック中は画面の動きを止める
- `spawnController.lock()`呼び出し直後に `ctrl.pause()`
- 回答送信（正誤に関わらず）/ESC解除時に `ctrl.resume()`

- 誤答時に入力リセット
- `submit()`で誤答でも `answer.value=''` にする

## 変更ファイル（要点）

- `src/main.js`
- タイトル時の非表示（`#top/#grid/#panel`）とオーバーレイ掃除
- `gameOver()`で`ctrl.stop()`、ボタン導線の確実化
- 選択時`ctrl.pause()`、送信後に`resume()`、誤答時も入力クリア
- `src/ui/title.js`
- 「設定」ボタン追加。オーバーレイで`mountSettings`を表示し閉じる導線
- （必要なら）`src/ui/result.js`
- ボタンのイベント確認（既存OK）

## テスト（サマリ）

- E2E: ゲームオーバー→「もう一度/タイトル/ステージ選択」が動作する
- ユニット: `submit()`誤答で入力クリア、`lock()`で`pause()`→`submit()`で`resume()`
- a11y: 影響なし（既存テスト通過）

### To-dos

- [ ] (placeholder)
- [ ] タイトルに四則レジェンド・ランクのパターン表示・問題数トグル
- [ ] タイトルからステージ選択（52枚）導線を実装/統合
- [ ] エンドレス出題とスポーンパターンの複数化
- [ ] 弾の命中先制御と爆発エフェクト＋SE
- [ ] BGM/SE導入・音量/ミュート設定と初回解錠
- [ ] 